---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# intervals

<!-- badges: start -->
<!-- badges: end -->

{intervals} helps users tidy up messy intervals. It can group and merge overlapping intervals as well as remove parts of one set of intervals, based on another set of intervals. In this context an interval is defined as having a start and a stop.  It can be numeric or date type.

{intervals} is mostly written in {data.table} for memory efficiency, it will always return a `data.table` object. 

## Installation

You can install the development version of intervals from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("ds-turner/intervals")
```

## Useage
```{r}
library(intervals)
```
### Grouping and Packing
```{r}

 ints <- data.frame(
    id = c("A", "A", "A", "B", "B", "B"),
    st = c(1, 2, 5, 10, 12, 14),
    end = c(3, 4, 7, 11, 14, 16)
  )
 ints
```

`ints` is a set of overlapping intrevals.   We can identify the overlapping intervals and add an ID column `int_grp_id` for overlapping groups.
```{r}
grp_ints(ints, st, end, id)
```
We can also merge the overlapping intervels into single intervals.
```{r}
pac_ints(ints, st, end, id)
```
### Triming
You can remove parts of intervals based on another set of intervals.
```{r}
pats <- 7

x <- data.frame(
  id = c(1:pats),
  start = rep(5, pats),
  end = rep(20, pats)
)

y <- data.frame(
  id = c(1, 2, 3, 4, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7),
  start = c(10, 4, 4, 19, 4, 10, 19, 4, 9, 14, 19, 7, 9, 11, 13),
  end = c(15, 21, 6, 21, 6, 15, 21, 6, 11, 16, 21, 8, 10, 12, 18)
)
```

Here we will remove the parts of the intervals in x that overlap with the intervals in y.
```{r}
trm_ints(x, y, start, end, start, end, id)
```

### Negative intervals
```{r}
ints <- data.frame(
  id = c("a", "a", "a", "a", "a", "b", "b", "c",   "c", "c", "c", "d"),
  start = c(1, 4, 10, 18, 23, 7, 12, 1, 7, 12, 23, 10),
  end = c(3, 7, 15, 21, 25, 9, 16, 3, 9, 16, 25, 15),
  index = c(5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5),
  study_end = c(20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20)
)
ints
```
We can also create a set of intervals that represent the gaps between the given intervals.
```{r}
neg_ints(ints, start, end, id)
```
These intervals can have an upper and lower bounds if required
```{r}
neg_ints(ints, start, end, id, .lower = index, .upper = study_end)
```
